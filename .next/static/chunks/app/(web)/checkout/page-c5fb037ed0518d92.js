(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[7880],{4767:function(e,s,a){Promise.resolve().then(a.bind(a,6698))},6698:function(e,s,a){"use strict";a.r(s);var n=a(7437);a(7138);var t=a(2265),r=a(6463),i=a(1444),l=a(6323),c=a(1085);s.default=()=>{let e=(0,r.useRouter)(),[s,a]=(0,t.useState)(""),[h,o]=(0,t.useState)(""),[d,m]=(0,t.useState)(""),[u,p]=(0,t.useState)(""),[g,x]=(0,t.useState)(0),[j,_]=(0,t.useState)(""),N=(0,i.v9)(e=>e.cart.items),[v,y]=(0,t.useState)(null),f=(0,i.I0)();(0,t.useEffect)(()=>{(async()=>{try{let e=JSON.parse(localStorage.getItem("userInfo")).token,s=await fetch("http://localhost:5000/users/profile",{headers:{Authorization:"Bearer ".concat(e)}});if(!s.ok)throw Error("Lỗi xảy ra khi lấy th\xf4ng tin người d\xf9ng");let n=await s.json();y(n),o(n.username||""),a(n.phone||""),m(n.address||"")}catch(e){console.error("Fetch error:",e)}})()},[]);let b=e=>{_(e.target.value)};(0,t.useEffect)(()=>{let e;e=0,N.forEach(s=>{e+=s.price*s.quantity}),x(e)},[N]);let S=()=>h?s?/(84|0[3|5|7|8|9])+([0-9]{8})\b/g.test(s)?d?null:"Lỗi! Vui l\xf2ng nhập Địa chỉ":"Lỗi! Số điện thoại kh\xf4ng hợp lệ":"Lỗi! Vui l\xf2ng nhập Số Điện Thoại":"Lỗi! Vui l\xf2ng nhập Họ T\xean",k=async a=>{if(a.preventDefault(),0===N.length){p("Bạn cần c\xf3 \xedt nhất một sản phẩm trong giỏ h\xe0ng!");return}let n=S();if(n){p(n);return}try{let a=await fetch("http://localhost:5000/orders/create",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({phone:s,username:h,address:d,totalAmount:g,cart:N,paymentMethod:j})}),n=await a.json();if(a.ok){let s=n._id;if("0"===j){let e=await fetch("http://localhost:5000/payments/createPayment",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({amount:g+38e3,orderInfo:"".concat(s),orderId:s})}),a=await e.json();e.ok?window.location.href=a.payUrl:p(a.error||"Lỗi khi tạo y\xeau cầu thanh to\xe1n MoMo")}else(0,l.ID)("Đặt h\xe0ng th\xe0nh c\xf4ng!","success"),f((0,c.LL)()),setTimeout(()=>{e.push("/")},1500)}else p(n.error||"Lỗi! C\xf3 lỗi xảy ra")}catch(e){p("Xin vui l\xf2ng nhập đầy đủ th\xf4ng tin!")}};return(0,n.jsxs)("div",{className:"main-container",children:[(0,n.jsxs)("div",{className:"register-form grid wide",children:[u&&(0,n.jsx)("p",{className:"alert alert-danger",children:u}),(0,n.jsxs)("form",{onSubmit:k,className:"form grid__row",id:"form-1",children:[(0,n.jsxs)("div",{className:"c-8",children:[(0,n.jsx)("h3",{className:"heading",children:"Th\xf4ng tin kh\xe1ch h\xe0ng"}),(0,n.jsxs)("div",{className:"grid__row",children:[(0,n.jsx)("div",{className:"c-6",children:(0,n.jsxs)("div",{className:"form-group col",children:[(0,n.jsx)("label",{htmlFor:"username",className:"form-label",children:"T\xean t\xe0i khoản:"}),(0,n.jsx)("input",{value:h,onChange:e=>o(e.target.value),id:"username",name:"username",type:"text",placeholder:"Họ t\xean...",className:"form-control"}),(0,n.jsx)("span",{className:"form-message"})]})}),(0,n.jsx)("div",{className:"c-6",children:(0,n.jsxs)("div",{className:"form-group col",children:[(0,n.jsx)("label",{htmlFor:"phone",className:"form-label",children:"Số điện thoại:"}),(0,n.jsx)("input",{value:s,onChange:e=>a(e.target.value),id:"phone",name:"phone",type:"text",placeholder:"Số điện thoại...",className:"form-control"}),(0,n.jsx)("span",{className:"form-message"})]})}),(0,n.jsx)("div",{className:"c-12",children:(0,n.jsxs)("div",{className:"form-group col",children:[(0,n.jsx)("label",{htmlFor:"address",className:"form-label",children:"Địa chỉ:"}),(0,n.jsx)("input",{value:d,onChange:e=>m(e.target.value),id:"address",name:"address",type:"text",placeholder:"Địa chỉ...",className:"form-control"}),(0,n.jsx)("span",{className:"form-message"})]})}),(0,n.jsx)("div",{className:"c-12",children:(0,n.jsxs)("div",{className:"checkout-payment",children:[(0,n.jsx)("h3",{className:"heading",children:"Phương thức thanh to\xe1n"}),(0,n.jsxs)("div",{className:"block-border",children:[(0,n.jsx)("p",{children:"Mọi giao dịch đều được bảo mật v\xe0 m\xe3 h\xf3a. Th\xf4ng tin thẻ t\xedn dụng sẽ kh\xf4ng bao giờ được lưu lại."}),(0,n.jsxs)("div",{className:"checkout-payment__options",children:[(0,n.jsxs)("label",{className:"ds__item",children:[(0,n.jsx)("input",{className:"ds__item__input",type:"radio",name:"payment_method",id:"payment_method_5",value:"0",checked:"0"===j,onChange:b}),(0,n.jsx)("span",{className:"ds__item__label",children:"Thanh to\xe1n bằng MoMo"})]}),(0,n.jsxs)("label",{className:"ds__item",children:[(0,n.jsx)("input",{className:"ds__item__input",type:"radio",name:"payment_method",id:"payment_method_3",value:"1",checked:"1"===j,onChange:b}),(0,n.jsx)("span",{className:"ds__item__label",children:"Thanh to\xe1n khi giao h\xe0ng"})]})]})]})]})})]})]}),(0,n.jsxs)("div",{className:"c-3",children:[(0,n.jsx)("div",{className:"cart-summary",children:(0,n.jsx)("div",{id:"box_product_total",children:(0,n.jsxs)("div",{className:"cart-summary__overview",children:[(0,n.jsx)("h3",{className:"heading",children:"T\xf3m tắt đơn h\xe0ng"}),(0,n.jsxs)("div",{className:"cart-summary__overview__item",children:[(0,n.jsx)("p",{children:"Tổng tiền h\xe0ng"}),(0,n.jsx)("p",{children:g.toLocaleString("vi-VN",{style:"currency",currency:"VND"})})]}),(0,n.jsxs)("div",{className:"cart-summary__overview__item",children:[(0,n.jsx)("p",{children:"Tạm t\xednh"}),(0,n.jsx)("p",{children:g.toLocaleString("vi-VN",{style:"currency",currency:"VND"})})]}),(0,n.jsxs)("div",{className:"cart-summary__overview__item",children:[(0,n.jsx)("p",{children:"Ph\xed vận chuyển"}),(0,n.jsx)("p",{children:"38.000đ"})]}),(0,n.jsxs)("div",{className:"cart-summary__overview__item",children:[(0,n.jsx)("p",{children:"Tiền thanh to\xe1n"}),(0,n.jsx)("p",{children:(g+38e3).toLocaleString("vi-VN",{style:"currency",currency:"VND"})})]}),(0,n.jsx)("hr",{style:{marginTop:20}})]})})}),(0,n.jsx)("div",{className:"col",children:(0,n.jsx)("button",{className:"form-submit",type:"submit",children:"Ho\xe0n th\xe0nh"})})]})]})]}),(0,n.jsx)("div",{className:"site-bottom"})]})}}},function(e){e.O(0,[4556,4911,9461,7138,1444,1116,5704,6323,2971,7023,1744],function(){return e(e.s=4767)}),_N_E=e.O()}]);